// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = "postgresql://postgres:aA@456456@localhost:5432/capstone?schema=public"
}

model User {
  user_id Int     @id @default(autoincrement())
  email   BigInt  @unique @db.BigInt
  profile String? @db.Text
  name    String? @db.VarChar(10)

  library      UserLib?
  user_info    UserStatus?
  user_setting UserSetting?

  searchs Search[]

  @@index([email], type: Hash)
  @@map("USER")
}

model Category {
  category String @id @db.VarChar(10)

  user_librarys UserLib[]
  category_book CategoryBook[]

  @@map("CATEGORY")
}

model UserLib {
  user_id       Int     @id
  best_category String? @db.VarChar(10)
  book_total    Int     @default(0) @db.Integer
  profile       String? @db.Text

  category Category? @relation(fields: [best_category], references: [category])
  user     User      @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  rents Rent[]
  books Book[]
  rooms Room[] @relation("users")
  attns Room[] @relation("attns")

  @@map("USER_LIB")
}

model UserStatus {
  user_id      Int       @id
  return_date  DateTime? @db.Timestamp(0)
  rental_total Int       @default(0)

  user User @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@map("USER_STATUS")
}

model UserSetting {
  user_id Int @id

  user User @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@map("USER_SETTING")
}

model Book {
  book_id   Int     @id @default(autoincrement())
  img       String? @db.Text
  name      String  @db.VarChar(10)
  publisher String  @db.VarChar(10)
  ISPN      String  @db.VarChar(50)
  author    String  @db.VarChar(20)
  user_id   Int?    @db.Integer
  is_rent   Boolean @default(false) @db.Boolean

  user       UserLib?       @relation(fields: [user_id], references: [user_id], onDelete: SetNull)
  categories CategoryBook[]
  rents      Rent[]

  @@map("BOOK")
}

model CategoryBook {
  category_name String @db.VarChar(10)
  book_id       Int    @db.Integer

  category Category @relation(fields: [category_name], references: [category])
  book     Book     @relation(fields: [book_id], references: [book_id], onDelete: Cascade)

  @@id([category_name, book_id])
  @@map("CATEGORY_BOOK")
}

model Room {
  user_id      Int      @db.Integer
  attn_id      Int      @db.Integer
  last_message String   @db.VarChar(255)
  last_date    DateTime @default(now()) @db.Timestamp(0)

  user UserLib @relation("users", fields: [user_id], references: [user_id])
  attn UserLib @relation("attns", fields: [attn_id], references: [user_id])

  chats Chat[] @relation("room")

  @@id([user_id, attn_id])
  @@map("ROOM")
}

model Chat {
  user_id Int      @db.Integer
  attn_id Int      @db.Integer
  date    DateTime @default(now()) @db.Timestamp(0)
  message String   @db.Text

  room Room @relation("room", fields: [user_id, attn_id], references: [user_id, attn_id])

  @@id([user_id, attn_id, date])
  @@map("CHAT")
}

model Rent {
  user_id Int      @db.Integer
  book_id Int      @db.Integer
  date    DateTime @default(now()) @db.Timestamp(0)

  user UserLib @relation(fields: [user_id], references: [user_id])
  book Book    @relation(fields: [book_id], references: [book_id], onDelete: Cascade)

  @@id([user_id, book_id])
  @@map("RENT")
}

model Search {
  search_id Int    @id @default(autoincrement()) @db.Integer
  user_id   Int    @db.Integer
  content   String @db.VarChar(50)

  user User @relation(fields: [user_id], references: [user_id])

  @@map("SEARCH")
}
